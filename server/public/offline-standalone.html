<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Survival Tools - Mahapala Narotama</title>
    <link rel="manifest" href="/manifest.json">
    <style>
        /* Inline semua CSS yang diperlukan untuk offline */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5f3e5 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .status-bar {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 12px;
        }
        
        .online { background: #dcfce7; color: #166534; }
        .offline { background: #fee2e2; color: #dc2626; }
        
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .card h2 {
            color: #166534;
            margin-bottom: 15px;
            font-size: 24px;
        }
        
        .btn {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            transform: none;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: #f9fafb;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .checklist-item.checked {
            background: #ecfdf5;
            border-color: #22c55e;
        }
        
        .icon {
            font-size: 24px;
            margin-right: 12px;
        }
        
        .nav-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .nav-tab {
            padding: 8px 16px;
            border-radius: 6px;
            background: #f3f4f6;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-weight: 500;
        }
        
        .nav-tab.active {
            background: #166534;
            color: white;
        }
        
        .emergency-list {
            list-style: none;
        }
        
        .emergency-list li {
            padding: 10px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .emergency-number {
            font-weight: bold;
            color: #dc2626;
        }
        
        .survival-tips {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .survival-tips h3 {
            color: #92400e;
            margin-bottom: 10px;
        }
        
        .gps-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 12px;
        }
        
        .gps-table th,
        .gps-table td {
            border: 1px solid #d1d5db;
            padding: 8px;
            text-align: left;
        }
        
        .gps-table th {
            background: #f9fafb;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="status" class="status-bar offline">Offline</div>
    
    <div class="container">
        <div class="card">
            <h1 style="text-align: center; color: #166534; margin-bottom: 10px;">üèïÔ∏è Survival Tools</h1>
            <p style="text-align: center; color: #6b7280; margin-bottom: 20px;">
                Tetap siap di alam bebas! Semua fitur dapat diakses tanpa internet.
            </p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('survival')">Panduan</button>
            <button class="nav-tab" onclick="showTab('checklist')">Checklist</button>
            <button class="nav-tab" onclick="showTab('emergency')">Darurat</button>
            <button class="nav-tab" onclick="showTab('gps')">GPS</button>
        </div>
        
        <div id="tab-survival" class="tab-content">
            <div class="card">
                <h2>üìö Panduan Survival</h2>
                <div class="survival-tips">
                    <h3>Tips Dasar Survival:</h3>
                    <ul>
                        <li>Tetap tenang, jangan panik</li>
                        <li>Cari sumber air bersih</li>
                        <li>Buat shelter/perlindungan</li>
                        <li>Gunakan sinyal darurat (peluit, asap, cermin)</li>
                        <li>Hemat energi dan makanan</li>
                    </ul>
                </div>
                <button class="btn" onclick="window.open('/panduan-survival.pdf', '_blank')">
                    üìñ Buka Panduan PDF
                </button>
                <button class="btn" onclick="window.open('/navigasi-darat.pdf', '_blank')">
                    üß≠ Navigasi Darat
                </button>
                <button class="btn" onclick="window.open('/ppgd.pdf', '_blank')">
                    üè• PPGD PDF
                </button>
            </div>
        </div>
        
        <div id="tab-checklist" class="tab-content" style="display: none;">
            <div class="card">
                <h2>‚úÖ Checklist Survival</h2>
                <div id="checklist-items"></div>
                <button class="btn" onclick="resetChecklist()">Reset Checklist</button>
            </div>
        </div>
        
        <div id="tab-emergency" class="tab-content" style="display: none;">
            <div class="card">
                <h2>üö® Nomor Darurat</h2>
                <ul class="emergency-list">
                    <li>SAR Nasional (Basarnas) <span class="emergency-number">115</span></li>
                    <li>BPBD Surabaya <span class="emergency-number">031-8499909</span></li>
                    <li>Polisi <span class="emergency-number">110</span></li>
                    <li>Ambulans <span class="emergency-number">118</span></li>
                    <li>RSU Dr. Soetomo <span class="emergency-number">031-5501078</span></li>
                </ul>
            </div>
        </div>
        
        <div id="tab-gps" class="tab-content" style="display: none;">
            <div class="card">
                <h2>üìç Pelacak GPS</h2>
                <div id="gps-input">
                    <input type="text" id="nama" placeholder="Nama Anda" style="padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; margin-right: 10px;">
                    <button class="btn" onclick="setNama()">Simpan Nama</button>
                </div>
                <div id="gps-controls" style="display: none;">
                    <button class="btn" onclick="startGPS()">Mulai Pelacakan</button>
                    <button class="btn" onclick="stopGPS()">Stop</button>
                    <button class="btn" onclick="resetGPS()">Reset Data</button>
                    <div id="gps-status" style="margin: 10px 0; font-weight: bold;"></div>
                    <table class="gps-table">
                        <thead>
                            <tr><th>Waktu</th><th>Lat</th><th>Lon</th><th>Status</th></tr>
                        </thead>
                        <tbody id="gps-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Update status online/offline
        function updateStatus() {
            const statusEl = document.getElementById('status');
            if (navigator.onLine) {
                statusEl.textContent = 'Online';
                statusEl.className = 'status-bar online';
            } else {
                statusEl.textContent = 'Offline';
                statusEl.className = 'status-bar offline';
            }
        }
        
        window.addEventListener('online', updateStatus);
        window.addEventListener('offline', updateStatus);
        updateStatus();
        
        // Tab functionality
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById('tab-' + tabName).style.display = 'block';
            
            // Add active class to clicked nav tab
            event.target.classList.add('active');
        }
        
        // Checklist functionality
        const checklistItems = [
            { icon: 'üß≠', label: 'Kompas' },
            { icon: 'üèïÔ∏è', label: 'Bivak/Shelter' },
            { icon: 'üìØ', label: 'Peluit' },
            { icon: 'üî™', label: 'Pisau' },
            { icon: 'üí°', label: 'Senter/Headlamp' },
            { icon: 'üç±', label: 'Makanan Cadangan' },
            { icon: 'ü©π', label: 'P3K' },
            { icon: 'üö∞', label: 'Botol Air' },
            { icon: 'üåßÔ∏è', label: 'Jas Hujan' },
            { icon: 'ü™¢', label: 'Tali Paracord' },
            { icon: 'üëï', label: 'Pakaian Cadangan' },
            { icon: 'üî•', label: 'Korek Api/Firestarter' }
        ];
        
        function initChecklist() {
            const container = document.getElementById('checklist-items');
            const saved = JSON.parse(localStorage.getItem('survival_checklist') || '[]');
            
            container.innerHTML = '';
            checklistItems.forEach((item, i) => {
                const checked = saved[i] || false;
                const div = document.createElement('div');
                div.className = `checklist-item ${checked ? 'checked' : ''}`;
                div.onclick = () => toggleChecklist(i);
                div.innerHTML = `
                    <span class="icon">${item.icon}</span>
                    <span style="flex: 1;">${item.label}</span>
                    <span style="font-size: 20px;">${checked ? '‚úÖ' : '‚¨ú'}</span>
                `;
                container.appendChild(div);
            });
        }
        
        function toggleChecklist(index) {
            const saved = JSON.parse(localStorage.getItem('survival_checklist') || '[]');
            while (saved.length <= index) saved.push(false);
            saved[index] = !saved[index];
            localStorage.setItem('survival_checklist', JSON.stringify(saved));
            initChecklist();
        }
        
        function resetChecklist() {
            localStorage.removeItem('survival_checklist');
            initChecklist();
        }
        
        // GPS functionality
        let gpsInterval = null;
        
        function setNama() {
            const nama = document.getElementById('nama').value.trim();
            if (!nama) {
                alert('Masukkan nama Anda');
                return;
            }
            localStorage.setItem('gps_nama', nama);
            document.getElementById('gps-input').style.display = 'none';
            document.getElementById('gps-controls').style.display = 'block';
            updateGPSTable();
        }
        
        function startGPS() {
            if (!navigator.geolocation) {
                alert('GPS tidak didukung browser ini');
                return;
            }
            
            document.getElementById('gps-status').textContent = 'Pelacakan aktif...';
            
            gpsInterval = setInterval(() => {
                navigator.geolocation.getCurrentPosition(
                    pos => {
                        const nama = localStorage.getItem('gps_nama');
                        const data = {
                            time: new Date().toLocaleString(),
                            lat: pos.coords.latitude.toFixed(6),
                            lon: pos.coords.longitude.toFixed(6),
                            nama: nama,
                            online: navigator.onLine
                        };
                        
                        const saved = JSON.parse(localStorage.getItem('gps_data') || '[]');
                        saved.push(data);
                        localStorage.setItem('gps_data', JSON.stringify(saved));
                        updateGPSTable();
                    },
                    err => {
                        document.getElementById('gps-status').textContent = 'Gagal mendapatkan lokasi: ' + err.message;
                    },
                    { enableHighAccuracy: true, maximumAge: 0, timeout: 10000 }
                );
            }, 10000);
        }
        
        function stopGPS() {
            if (gpsInterval) {
                clearInterval(gpsInterval);
                gpsInterval = null;
            }
            document.getElementById('gps-status').textContent = 'Pelacakan dihentikan';
        }
        
        function resetGPS() {
            stopGPS();
            localStorage.removeItem('gps_data');
            updateGPSTable();
        }
        
        function updateGPSTable() {
            const tbody = document.getElementById('gps-tbody');
            const saved = JSON.parse(localStorage.getItem('gps_data') || '[]');
            
            tbody.innerHTML = '';
            saved.slice(-10).forEach(data => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${data.time}</td>
                    <td>${data.lat}</td>
                    <td>${data.lon}</td>
                    <td><span style="color: ${data.online ? 'green' : 'red'}">${data.online ? 'Online' : 'Offline'}</span></td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // Initialize
        window.addEventListener('load', () => {
            const savedNama = localStorage.getItem('gps_nama');
            if (savedNama) {
                document.getElementById('nama').value = savedNama;
                document.getElementById('gps-input').style.display = 'none';
                document.getElementById('gps-controls').style.display = 'block';
            }
            
            initChecklist();
            updateGPSTable();
        });
        
        // Redirect ke aplikasi utama saat online
        window.addEventListener('online', () => {
            setTimeout(() => {
                if (confirm('Internet tersambung. Kembali ke aplikasi utama?')) {
                    window.location.href = '/';
                }
            }, 1000);
        });
    </script>
</body>
</html>