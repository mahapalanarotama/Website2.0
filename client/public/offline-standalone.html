<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mode Offline - Mahapala Narotama</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /*Navbar Styles */
        .navbar {
            background: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: #16a34a;
        }

        .navbar-logo img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 2px solid #16a34a;
            background: white;
        }

        .navbar-title {
            font-weight: bold;
            font-size: 20px;
            letter-spacing: 1px;
        }

        .navbar-title .accent {
            color: #dc2626;
            font-weight: bold;
        }

        .navbar-nav {
            display: flex;
            gap: 24px;
            list-style: none;
        }

        .navbar-nav a {
            text-decoration: none;
            color: #16a34a;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.3s ease;
            position: relative;
        }

        .navbar-nav a:hover {
            color: #dc2626;
            background: rgba(220, 38, 38, 0.1);
        }

        .navbar-nav a.active {
            color: #dc2626;
            background: rgba(220, 38, 38, 0.1);
        }

        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            color: #16a34a;
            cursor: pointer;
        }

        .mobile-nav {
            display: none;
            background: white;
            padding: 16px;
            border-radius: 0 0 16px 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .mobile-nav a {
            display: block;
            padding: 12px 16px;
            text-decoration: none;
            color: #16a34a;
            font-weight: 500;
            border-radius: 8px;
            margin-bottom: 4px;
            transition: all 0.3s ease;
        }

        .mobile-nav a:hover {
            background: rgba(220, 38, 38, 0.1);
            color: #dc2626;
        }

        @media (max-width: 768px) {
            .navbar-nav {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
            }
        }

        /* Status Badge */
        .status-indicator {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
        }

        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .status-badge.online {
            background: #10b981;
            color: white;
        }

        .status-badge.offline {
            background: #ef4444;
            color: white;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.7);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #374151;
        }

        .nav-tab:hover {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
        }

        .nav-tab.active {
            background: #16a34a;
            color: white;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Button Styles */
        .btn {
            background: linear-gradient(135deg, #16a34a, #15803d);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
            margin: 4px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(34, 197, 94, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
        }

        /* Input Styles */
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            margin-bottom: 12px;
        }

        .form-input:focus {
            outline: none;
            border-color: #16a34a;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-top: 16px;
        }

        .data-table th {
            background: #f8fafc;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            font-size: 12px;
        }

        .data-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #f1f5f9;
            font-size: 11px;
        }

        .data-table tr:hover {
            background: #f8fafc;
        }

        /* Checklist Styles */
        .checklist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .checklist-item:hover {
            background: #e2e8f0;
        }

        .checklist-item.checked {
            background: #dcfce7;
            color: #166534;
        }

        .checklist-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Emergency Styles */
        .emergency-card {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            border: 2px solid #ef4444;
            color: #7f1d1d;
        }

        .emergency-number {
            font-size: 24px;
            font-weight: bold;
            color: #dc2626;
            margin: 8px 0;
        }

        /* Footer Styles */
        .footer {
            background: #1f2937;
            color: white;
            padding: 48px 20px 24px;
            margin-top: auto;
        }

        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 32px;
            margin-bottom: 32px;
        }

        .footer-section h3 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 16px;
            color: white;
        }

        .footer-section p {
            color: #d1d5db;
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 8px;
        }

        .footer-section ul li a {
            color: #d1d5db;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-section ul li a:hover {
            color: white;
        }

        .social-links {
            display: flex;
            gap: 16px;
        }

        .social-links a {
            color: #d1d5db;
            font-size: 20px;
            transition: color 0.3s ease;
        }

        .social-links a:hover {
            color: white;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 24px;
            border-top: 1px solid #374151;
            color: #9ca3af;
        }

        /* RJP Counter */
        .rjp-counter {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            color: #dc2626;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 10px;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav-tab {
                text-align: center;
            }

            .data-table {
                font-size: 10px;
            }

            .data-table th,
            .data-table td {
                padding: 6px 4px;
            }
        }
    </style>
</head>
<body>
    <!--Navbar -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="/" class="navbar-logo">
                <img src="/Logo%20Mpn.png" alt="Logo Mahapala">
                <span class="navbar-title">
                    MAHAPALA <span class="accent">NAROTAMA</span>
                </span>
            </a>
            <ul class="navbar-nav">
                <li><a href="/">Beranda</a></li>
                <li><a href="/kegiatan">Kegiatan</a></li>
                <li><a href="/pembelajaran">Pembelajaran</a></li>
                <li><a href="/sejarah">Sejarah</a></li>
                <li><a href="/pendaftaran">Informasi Pendaftaran</a></li>
                <li><a href="/scan-anggota">üë• Anggota</a></li>
            </ul>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">‚ò∞</button>
        </div>
        <div class="mobile-nav" id="mobile-nav">
            <a href="/">Beranda</a>
            <a href="/kegiatan">Kegiatan</a>
            <a href="/pembelajaran">Pembelajaran</a>
            <a href="/sejarah">Sejarah</a>
            <a href="/pendaftaran">Informasi Pendaftaran</a>
            <a href="/scan-anggota">üë• Anggota</a>
        </div>
    </nav>

    <!-- Status Indicator -->
    <div class="status-indicator">
        <div id="status" class="status-badge offline">Offline</div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="card">
            <h1>üèïÔ∏è Mode Offline & Survival Tools</h1>
            <p style="color: #6b7280; margin-top: 12px;">Tetap siap di alam bebas! Semua fitur berikut dapat diakses tanpa internet.</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('survival')">üìö Panduan</button>
            <button class="nav-tab" onclick="showTab('checklist')">‚úÖ Checklist</button>
            <button class="nav-tab" onclick="showTab('emergency')">üö® Darurat</button>
            <button class="nav-tab" onclick="showTab('gps')">üìç GPS Tracker</button>
        </div>

        <!-- Tab Content: Survival Guide -->
        <div id="tab-survival" class="tab-content active">
            <div class="card">
                <h2>üìö Panduan Survival</h2>
                <p style="margin-bottom: 20px;">Download panduan lengkap untuk survival di alam bebas:</p>

                <button class="btn" onclick="window.open('/panduan-survival.pdf', '_blank')">
                    üìñ Download Panduan Survival
                </button>

                <button class="btn" onclick="window.open('/navigasi-darat.pdf', '_blank')">
                    üß≠ Download Panduan Navigasi Darat
                </button>

                <button class="btn" onclick="window.open('/ppgd.pdf', '_blank')">
                    üè• Download Panduan P3K/PPGD
                </button>

                <div style="margin-top: 20px; padding: 16px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                    <h3 style="color: #92400e; margin-bottom: 8px;">üí° Tips Menggunakan Offline:</h3>
                    <ul style="color: #92400e; margin-left: 20px;">
                        <li>Semua panduan PDF tersedia offline</li>
                        <li>GPS tracker menyimpan data lokal</li>
                        <li>Checklist survival tersimpan otomatis</li>
                        <li>Saat online kembali, data akan sinkron</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Tab Content: Checklist -->
        <div id="tab-checklist" class="tab-content">
            <div class="card">
                <h2>‚úÖ Checklist Perlengkapan Survival</h2>
                <p style="margin-bottom: 20px;">Pastikan semua perlengkapan penting sudah siap:</p>
                <div id="checklist-container"></div>
            </div>
        </div>

        <!-- Tab Content: Emergency -->
        <div id="tab-emergency" class="tab-content">
            <div class="card emergency-card">
                <h2>üö® Nomor Darurat</h2>

                <div style="display: grid; gap: 16px; margin: 20px 0;">
                    <div>
                        <strong>üöë Ambulans/Medis:</strong>
                        <div class="emergency-number">118 / 119</div>
                    </div>

                    <div>
                        <strong>üöì Polisi:</strong>
                        <div class="emergency-number">110</div>
                    </div>

                    <div>
                        <strong>üöí Pemadam Kebakaran:</strong>
                        <div class="emergency-number">113</div>
                    </div>

                    <div>
                        <strong>üèîÔ∏è SAR (Search and Rescue):</strong>
                        <div class="emergency-number">115</div>
                    </div>
                </div>

                <div style="background: white; padding: 16px; border-radius: 8px; margin-top: 20px;">
                    <h3 style="color: #dc2626; margin-bottom: 12px;">ü´Å Simulator RJP (Resusitasi Jantung Paru)</h3>
                    <p style="color: #374151; margin-bottom: 12px;">Latihan ritme kompresi dada 30:2 (30 kompresi, 2 nafas buatan)</p>

                    <div class="rjp-counter" id="rjp-counter">0</div>

                    <div style="text-align: center;">
                        <button class="btn" id="rjp-btn" onclick="startRJP()">Mulai Latihan RJP</button>
                        <button class="btn btn-danger" onclick="stopRJP()">Stop</button>
                    </div>

                    <div id="rjp-status" style="text-align: center; margin-top: 12px; font-weight: bold;"></div>
                </div>
            </div>
        </div>

        <!-- Tab Content: GPS Tracker -->
        <div id="tab-gps" class="tab-content">
            <div class="card">
                <h2>üìç Pelacak Lokasi GPS</h2>

                <!-- Input Nama -->
                <div id="gps-input" style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Masukkan Nama Anda:</label>
                    <input type="text" id="nama" class="form-input" placeholder="Nama Lengkap" style="max-width: 300px;">
                    <button class="btn" onclick="setNama()">Simpan Nama</button>
                </div>

                <!-- GPS Controls -->
                <div id="gps-controls" style="display: none; margin-bottom: 20px;">
                    <button class="btn" id="start-gps" onclick="startGPS()">üì° Aktifkan Pelacakan</button>
                    <button class="btn btn-danger" id="stop-gps" onclick="stopGPS()" disabled>‚èπÔ∏è Matikan GPS</button>
                    <button class="btn" onclick="resetGPS()">üóëÔ∏è Reset Data</button>
                </div>

                <!-- GPS Status -->
                <div id="gps-status" style="margin-bottom: 16px; padding: 12px; background: #f3f4f6; border-radius: 8px; font-weight: 600;"></div>

                <!-- GPS Data Table -->
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Waktu</th>
                                <th>Nama</th>
                                <th>Latitude</th>
                                <th>Longitude</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="gps-tbody"></tbody>
                    </table>
                </div>

                <p style="margin-top: 16px; color: #6b7280; font-size: 14px;">
                    üíæ Data lokasi tersimpan lokal & akan dikirim ke server saat online kembali.
                </p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>Tentang Kami</h3>
                    <p>Mahapala Narotama adalah organisasi yang bergerak di bidang eksplorasi alam dan pelestarian lingkungan.</p>
                    <div class="social-links">
                        <a href="https://www.instagram.com/mahapalanarotama" target="_blank">üì∑</a>
                        <a href="https://www.youtube.com/@mahapalanarotama1216" target="_blank">üì∫</a>
                        <a href="https://tiktok.com/" target="_blank">üéµ</a>
                    </div>
                </div>

                <div class="footer-section">
                    <h3>Link Terkait</h3>
                    <ul>
                        <li><a href="https://narotama.ac.id/" target="_blank">Universitas Narotama</a></li>
                        <li><a href="https://wartapalaindonesia.com/">WARTAPALA Indonesia</a></li>
                        <li><a href="/kegiatan">Daftar Kegiatan</a></li>
                        <li><a href="/galeri">Galeri Foto</a></li>
                        <li><a href="/url-shortener">URL Shortener</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>Hubungi Kami</h3>
                    <p>üìç Jl. Arief Rachman Hakim No. 51, Klampis Ngasem, Sukolilo, Kota Surabaya, Jawa Timur</p>
                    <p>üìû (031) 34133 2882</p>
                    <p>‚úâÔ∏è ukm.mahapala@narotama.ac.id</p>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2024 Mahapala Narotama. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global variables
        let gpsInterval = null;
        let rjpCount = 0;
        let rjpStarted = false;
        let rjpInterval = null;

        // Checklist items
        const checklistItems = [
            { icon: 'üß≠', label: 'Kompas' },
            { icon: 'üèïÔ∏è', label: 'Bivak/Shelter' },
            { icon: 'üìØ', label: 'Peluit' },
            { icon: 'üî™', label: 'Pisau' },
            { icon: 'üí°', label: 'Senter/Headlamp' },
            { icon: 'üç±', label: 'Makanan Cadangan' },
            { icon: 'ü©π', label: 'P3K' },
            { icon: 'üö∞', label: 'Botol Air' },
            { icon: 'üåßÔ∏è', label: 'Jas Hujan' },
            { icon: 'ü™¢', label: 'Tali Paracord' },
            { icon: 'üëï', label: 'Pakaian Cadangan' },
            { icon: 'üî•', label: 'Korek Api/Firestarter' }
        ];

        // Mobile menu toggle
        function toggleMobileMenu() {
            const mobileNav = document.getElementById('mobile-nav');
            mobileNav.style.display = mobileNav.style.display === 'block' ? 'none' : 'block';
        }

        // Update online/offline status
        function updateStatus() {
            const statusEl = document.getElementById('status');
            if (navigator.onLine) {
                statusEl.textContent = 'Online';
                statusEl.className = 'status-badge online';

                // Auto redirect saat online ke React component - hanya jika tidak diakses langsung
                if (!window.location.pathname.includes('offline-standalone.html')) {
                    setTimeout(() => {
                        if (confirm('Internet tersambung. Kembali ke aplikasi React?')) {
                            window.location.href = '/offline';
                        }
                    }, 1000);
                }
            } else {
                statusEl.textContent = 'Offline';
                statusEl.className = 'status-badge offline';
            }
        }

        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(`tab-${tabName}`).classList.add('active');

            // Add active class to clicked nav tab
            event.target.classList.add('active');
        }

        // Initialize checklist
        function initChecklist() {
            const container = document.getElementById('checklist-container');
            const saved = JSON.parse(localStorage.getItem('survival_checklist') || '{}');

            container.innerHTML = '';
            checklistItems.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = `checklist-item ${saved[index] ? 'checked' : ''}`;
                div.innerHTML = `
                    <input type="checkbox" ${saved[index] ? 'checked' : ''} 
                           onchange="toggleChecklistItem(${index})">
                    <span style="font-size: 20px;">${item.icon}</span>
                    <span style="flex: 1;">${item.label}</span>
                `;
                container.appendChild(div);
            });
        }

        // Toggle checklist item
        function toggleChecklistItem(index) {
            const saved = JSON.parse(localStorage.getItem('survival_checklist') || '{}');
            saved[index] = !saved[index];
            localStorage.setItem('survival_checklist', JSON.stringify(saved));
            initChecklist();
        }

        // RJP Functions
        function startRJP() {
            if (rjpStarted) return;

            rjpStarted = true;
            rjpCount = 0;
            document.getElementById('rjp-btn').textContent = 'Sedang Latihan...';
            document.getElementById('rjp-btn').disabled = true;

            // Rhythm: 100-120 compressions per minute = ~500-600ms interval
            rjpInterval = setInterval(() => {
                rjpCount++;
                document.getElementById('rjp-counter').textContent = rjpCount;

                // Status feedback
                const statusEl = document.getElementById('rjp-status');
                if (rjpCount <= 30) {
                    statusEl.textContent = `Kompresi ${rjpCount}/30`;
                    statusEl.style.color = '#dc2626';
                } else if (rjpCount === 31) {
                    statusEl.textContent = 'Berikan 2 nafas buatan!';
                    statusEl.style.color = '#2563eb';
                } else if (rjpCount === 32) {
                    statusEl.textContent = 'Siklus selesai! Ulangi...';
                    statusEl.style.color = '#16a34a';
                    rjpCount = 0; // Reset untuk siklus berikutnya
                }
            }, 550); // ~109 BPM
        }

        function stopRJP() {
            if (rjpInterval) {
                clearInterval(rjpInterval);
                rjpInterval = null;
            }
            rjpStarted = false;
            rjpCount = 0;
            document.getElementById('rjp-counter').textContent = '0';
            document.getElementById('rjp-btn').textContent = 'Mulai Latihan RJP';
            document.getElementById('rjp-btn').disabled = false;
            document.getElementById('rjp-status').textContent = '';
        }

        // GPS Functions
        function setNama() {
            const nama = document.getElementById('nama').value.trim();
            if (!nama) {
                alert('Silakan masukkan nama terlebih dahulu!');
                return;
            }

            localStorage.setItem('gps_nama', nama);
            document.getElementById('gps-input').style.display = 'none';
            document.getElementById('gps-controls').style.display = 'block';
            document.getElementById('gps-status').textContent = `Siap melacak untuk: ${nama}`;
        }

        function startGPS() {
            const nama = localStorage.getItem('gps_nama');
            if (!nama) {
                alert('Nama belum diset!');
                return;
            }

            if (!navigator.geolocation) {
                alert('GPS tidak didukung di browser ini!');
                return;
            }

            document.getElementById('start-gps').disabled = true;
            document.getElementById('stop-gps').disabled = false;
            document.getElementById('gps-status').textContent = 'Memulai pelacakan GPS...';

            // Tracking setiap 10 detik
            gpsInterval = setInterval(() => {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        const time = new Date().toLocaleString('id-ID');
                        const online = navigator.onLine;

                        const data = {
                            nama: nama,
                            lat: lat,
                            lon: lon,
                            time: time,
                            online: online
                        };

                        // Simpan ke localStorage
                        let saved = JSON.parse(localStorage.getItem('gps_data') || '[]');
                        saved.push(data);

                        // Batasi maksimal 100 record terakhir
                        if (saved.length > 100) {
                            saved = saved.slice(-100);
                        }

                        localStorage.setItem('gps_data', JSON.stringify(saved));

                        // Update status
                        document.getElementById('gps-status').textContent = 
                            `Pelacakan aktif - Lokasi: ${lat.toFixed(6)}, ${lon.toFixed(6)} | Status: ${online ? 'Online' : 'Offline'}`;

                        // Update table
                        updateGPSTable();

                        // Sync ke server jika online
                        if (online) {
                            syncToServer(data);
                        }
                    },
                    (error) => {
                        document.getElementById('gps-status').textContent = 
                            `Error GPS: ${error.message}`;
                    },
                    { 
                        enableHighAccuracy: true, 
                        timeout: 10000, 
                        maximumAge: 0 
                    }
                );
            }, 10000);
        }

        function stopGPS() {
            if (gpsInterval) {
                clearInterval(gpsInterval);
                gpsInterval = null;
            }
            document.getElementById('start-gps').disabled = false;
            document.getElementById('stop-gps').disabled = true;
            document.getElementById('gps-status').textContent = 'Pelacakan dimatikan dan data dihapus.';

            // Clear data
            localStorage.removeItem('gps_data');
            updateGPSTable();
        }

        function resetGPS() {
            if (gpsInterval) {
                clearInterval(gpsInterval);
                gpsInterval = null;
            }
            document.getElementById('start-gps').disabled = false;
            document.getElementById('stop-gps').disabled = true;
            localStorage.removeItem('gps_data');
            document.getElementById('gps-status').textContent = 'Data GPS telah direset.';
            updateGPSTable();
        }

        function updateGPSTable() {
            const tbody = document.getElementById('gps-tbody');
            const saved = JSON.parse(localStorage.getItem('gps_data') || '[]');

            tbody.innerHTML = '';

            if (saved.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="5" style="text-align: center; color: #9ca3af;">Belum ada data GPS</td>';
                tbody.appendChild(tr);
                return;
            }

            // Tampilkan 10 data terakhir
            saved.slice(-10).forEach(data => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${data.time}</td>
                    <td>${data.nama}</td>
                    <td>${data.lat.toFixed(6)}</td>
                    <td>${data.lon.toFixed(6)}</td>
                    <td>
                        <span style="
                            padding: 4px 8px; 
                            border-radius: 12px; 
                            font-size: 10px; 
                            font-weight: bold;
                            background: ${data.online ? '#dcfce7' : '#fee2e2'};
                            color: ${data.online ? '#166534' : '#dc2626'};
                        ">
                            ${data.online ? 'Online' : 'Offline'}
                        </span>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Sync data to server (dummy function)
        async function syncToServer(data) {
            try {
                // Simulasi sync ke server
                console.log('Syncing GPS data to server:', data);
                // Di implementasi nyata, kirim ke API endpoint
                // await fetch('/api/gps-tracker', { method: 'POST', body: JSON.stringify(data) });
            } catch (error) {
                console.error('Sync error:', error);
            }
        }

        // Event listeners
        window.addEventListener('online', updateStatus);
        window.addEventListener('offline', updateStatus);

        // Initialize
        window.addEventListener('load', () => {
            updateStatus();
            initChecklist();
            updateGPSTable();

            // Check if nama already saved
            const savedNama = localStorage.getItem('gps_nama');
            if (savedNama) {
                document.getElementById('nama').value = savedNama;
                document.getElementById('gps-input').style.display = 'none';
                document.getElementById('gps-controls').style.display = 'block';
                document.getElementById('gps-status').textContent = `Siap melacak untuk: ${savedNama}`;
            }
        });
    </script>
</body>
</html>